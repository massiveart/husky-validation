/*
 * This file is part of the Husky Validation.
 *
 * (c) MASSIVE ART WebServices GmbH
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 *
 */

require.config({paths:{min:"js/validators/min",max:"js/validators/max",minlength:"js/validators/minlength",maxlength:"js/validators/maxlength",required:"js/validators/required",date:"js/types/date",decimal:"js/types/decimal"}}),define("js/element",[],function(){return function(e,t){var n={trigger:"focusout",addclasses:!0},r=["validate","type","prop","trigger"],i,s={initialize:function(){this.options=$.extend({},n,t),this.$el=$(e),this.data=this.$el.data(),this.data.hasOwnProperty("trigger")&&(this.options.trigger=this.data.trigger),this.initValidators(),this.initType(),this.bindDomEvents(),this.$el.data("element",this);var r=this.$el.data("prop");console.log(r+": validators",this.validators),console.log(r+": type",this.type)},bindDomEvents:function(){var e=this.options.trigger?this.options.trigger:"";this.$el.is("select")&&(e+=(new RegExp("change","i")).test(e)?"":" change"),e=e.replace(/^\s+/g,"").replace(/\s+$/g,""),this.$el.bind(e,this.validate.bind(this))},initValidators:function(){this.validators={},$.each(this.data,function(e,t){$.inArray(e,r)==-1&&!!t&&require([e],function(t){this.validators[e]=new t(this.$el)}.bind(this))}.bind(this))},initType:function(){this.type=null,this.data.hasOwnProperty("type")&&require([this.data.type],function(e){this.type=new e(this.$el)}.bind(this))},validate:function(e){if(!this.hasConstraints())return this.reset(),!0;var t=!0;return $.each(this.validators,function(e,n){n.validate()||(t=!1)}),this.type!=null&&!this.type.validate()&&(t=!1),this.setValid(t),this.isValid()},hasConstraints:function(){return Object.keys(this.validators).length>0||this.type!=null},reset:function(){this.$el.removeClass("husky-validate-success"),this.$el.removeClass("husky-validate-error")},setValid:function(e){i=e,!this.options.addclasses||(this.reset(),e?this.$el.addClass("husky-validate-success"):this.$el.addClass("husky-validate-error"))},isValid:function(){return i},updateConstraint:function(e,t){if(!($.inArray(e,Object.keys(this.validators))>-1))throw"No constraint with name: "+e;this.validators[e].updateConstraint(t),this.validate(!0)},deleteConstraint:function(e){if(!($.inArray(e,Object.keys(this.validators))>-1))throw"No constraint with name: "+e;delete this.validators[e],this.validate(!0)},addConstraint:function(e,t){if($.inArray(e,Object.keys(this.validators))!=-1)throw"Constraint with name: "+e+" already exists";require([e],function(n){this.validators[e]=new n(this.$el,t),this.validate(!0)}.bind(this))}};return s.initialize(),s}}),define("js/validation",["js/element"],function(e){return function(t,n){var r={submitEvent:!0,element:{trigger:"focusout",addclasses:!0}},i=[],s,o={initialize:function(){this.options=$.extend({},r,n),this.$el=t;var s=this.options.element;this.$el.find('*[data-validate="true"]').each(function(){i.push(new e(this,s))}),console.log("validation: elements",i),this.bindDomEvents()},bindDomEvents:function(){!this.options.submitEvent||this.$el.on("submit",function(){return this.validate()}.bind(this))},validate:function(){var e=!0;return $.each(i,function(t,n){n.validate()||(e=!1)}),s=e,e},isValid:function(){return s},updateConstraint:function(e,t,n){$(e).data("element").updateConstraint(t,n)},deleteConstraint:function(e,t){$(e).data("element").deleteConstraint(t)},addConstraint:function(e,t,n){$(e).data("element").addConstraint(t,n)}};return o.initialize(),o}}),define("js/types/date",[],function(){return function(e,t){var n={regExp:/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/},r={initialize:function(){this.options=$.extend({},n,t),this.$el=e},validate:function(){return this.options.regExp.test(this.$el.val())}};return r.initialize(),r}}),define("js/types/decimal",[],function(){return function(e,t){var n={regExp:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/},r={initialize:function(){this.options=$.extend({},n,t),this.$el=e},validate:function(){return this.options.regExp.test(this.$el.val())}};return r.initialize(),r}}),define("js/validators/default",[],function(){return function(e,t,n,r){return{name:r,initialize:function(){this.$el=e,this.data=$.extend(t,this.$el.data(),n),!this.initializeSub||this.initializeSub()},updateConstraint:function(e){this.data=$.extend({},this.data,e)}}}}),define("js/validators/max",["js/validators/default"],function(e){return function(t,n){var r={max:999},i=$.extend({},new e(t,r,n,"max"),{validate:function(){var e=this.$el.val();return Number(e)<=this.data.max}});return i.initialize(),i}}),define("js/validators/maxlength",["js/validators/default"],function(e){return function(t,n){var r={maxlength:999},i=$.extend({},new e(t,r,n,"maxlength"),{validate:function(){var e=this.$el.val();return e.length<=this.data.maxlength}});return i.initialize(),i}}),define("js/validators/min",["js/validators/default"],function(e){return function(t){var n={min:0},r=$.extend({},new e(t,n,"min"),{validate:function(){var e=this.$el.val();return Number(e)>=this.data.min}});return r.initialize(),r}}),define("js/validators/minlength",["js/validators/default"],function(e){return function(t,n){var r={minlength:0},i=$.extend({},new e(t,r,n,"minlength"),{validate:function(){var e=this.$el.val();return e.length>=this.data.minlength}});return i.initialize(),i}}),define("js/validators/required",["js/validators/default"],function(e){return function(t,n){var r={},i=$.extend({},new e(t,r,n,"required"),{validate:function(){if(!!this.data.required){var e=this.$el.val();if("object"==typeof e){for(var t in e)if(this.validate(e[t]))return!0;return!1}return e.length>0&&""!==e.replace(/^\s+/g,"").replace(/\s+$/g,"")}return!0}});return i.initialize(),i}});